 #### ! Проект временно заморожен
# OXG.CRM-System

CRM-система предназначенная для предприятия оказывающего развлекательные услуги.


## Начало работы

Для запуска проекта на локальном сервере у вас должен быть установлен MS SQL Server.
База данных автоматически инициализируется при первом запуске.

Для работы сервиса отправки договоров по электронной почте необходимо в секции конфигурации, находящейся по адресу Admin/Setting, указать адрес с которого будет производиться отправка и указать пароль.

В приложении определено 4 типа пользователей: Администратор, Менеджер, Техник и Артист.
Менеджер - Отвечает за работу с клиентами, заказами и создание задач для других пользователей.
Техник - После заказа какого-либо мероприятия, должен выехать на место проведения и согласовать
соответствие площадки требованиям для артистов и ТБ.
Артист - Непосредственно работает на мероприятии, приложение использует только для напоминаний и уведомлений.
Администратор - отвечает за общую работу всего этого безобразия, может управлять правами доступа пользователей,
настройками для приложения, видит уведомления всех пользователей и графики.

Для использования Бота ВК вам будет необходимо после развёртывания проекта, настроить свою группу для работы с ботом,
[инструкция ](https://habr.com/ru/post/441720/) - пункт настройка CallBackAPI. 

Для изменения функции автоматического создания договоров для клиента необходимо:
 * Изменить шаблон договора в соответствии с вашими требованиями [инструкция](https://habr.com/ru/post/269307/)
 * Изменить логику генерации договора в методе Create, контроллера ContractController.

## Для разработчиков
- Бот ВК 
```
Строка подтверждения возвращаемая приложением и токен доступа находятся в файле appsettings.json, 
в секции Config.
Логика бота находится в методе [Post]Callback контроллера CallbackController.
```
- WebAPI
```
В приложении определён AJAXController, для асинхронного получения информации с сервера
без перезагрузки страницы, все методы в данном контроллере вызываются через JQuery на стороне клиента
Доступ к контроллеру имеют только авторизованные пользователи
Все методы в контроллере прокомментированы
```
- Отправка Email
```
Настройки для работы с электронной почтой определены в классе EmailService в папке Data, 
Настройки по умолчанию определены в статическом классе StaticValues, находящемся в той же папке
```
- База данных
```
Работа с базой данных осуществляется через EF Core.
Контекст БД определён в классе CRMDbContext, находящемся в папке Data
Строка подключения определена в файле appsettings.json, в секции ConnectionStrings.
За инициализацию БД отвечает метод InitializeAsync в классе DBInitializer.
Этот метод вызывается при переходе на страницу Home/Index, и инициализирует базу тестовыми пользователями,
списком услуг, и ролями для пользователей.
```
- Статические значения
```
Для удобства, на время разработки, часть
постоянно использующихся значений вынесена в статический класс StaticValues, который в последствии будет заменён на базу данных.
```
- Тестирование
```
Тесты вынесены в отдельный проект OXG.CRM-System.Tets
Для тестирования использованы фреймворки xUnit и Moq, для работы с тестовой базой данных 
используется провайдер EF Core InMemory Database. 
Конфигурация задаётся в конструкторе класса тестов.
```
- Клиентская часть
```
Клиентская часть разработана на движке представлений RAZOR(HTML + CSS + JS + C#)
Использованные библиотеки:
- JQuery
- Bootstrap 4
- FontAwesome
- Charts.js
```
### Используемые NuGet-пакеты (Список зависимостей)

* MailKit (2.5.1)
* Microsoft.AspNetCore.Identity.EntityFrameworkCore (3.1.2)
* Microsoft.AspNetCore.Mvc.NewtonsoftJson (3.1.3)
* Microsoft.EntityFrameworkCore (3.1.2)
* Microsoft.EntityFrameworkCore.SqlServer (3.1.2)
* Microsoft.VisualStudio.Web.CodeGeneration.Design (3.1.2)
* System.IO (4.3.0)
* System.IO.Packaging (4.7.0)
* System.Linq (4.3.0)
* TemplateEngine.Docx (1.1.5)
* VkNet (1.50.0)